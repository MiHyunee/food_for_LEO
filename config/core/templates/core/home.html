{% extends 'base.html' %}

{% block content %}
<h1>home</h1>

<h3><a href="{% url 'core:login' %}">로그인하기</a></h3>

<h3><a href="{% url 'core:home' %}">home</a></h3>
<h3><a href="{% url 'core:brand_page' %}">brand_page</a></h3>
<h3><a href="{% url 'mypage:profile' %}">mypage</a></h3>

<div id="SearchBar">
    <input class="form-control" type="text" id="search"/>
    <button type="submit" value="get result" id="getResult"/>search</div>
    <ul class="list-group" id="result">
    </ul>
</div>
<script>
    function fetchJsonFilter(val) {
         var tags = [];
         //brand name filtering
        fetch('../../static/json/core_brand.json').then(function(response){
            response.text().then(function (text) {
                var b_list = JSON.parse(text);
                var show_brand=[];
                b_list.filter(function (element, index, array) {
                    if(array[index].name.includes(val)) {
                        console.log(array[index].name)
                        show_brand.push(array[index]);
                    }
                });
                var brand_tag = '<li class="list-group-item">' + show_brand[0].name + '</li>'
                tags=tags+brand_tag
            })
        })
        //product name filtering
        fetch('../../static/json/core_product.json').then(function (response) {
            response.text().then(function (text) {
                var p_list = JSON.parse(text);
                var show_product = [];
                p_list.filter(function (element, index, array) { //필터링하기
                    if (array[index].name.includes(val)) {
                        console.log(array[index].name)
                        show_product.push(array[index]);
                    }
                });
                for (var i=0; i<show_product.length; i++) {
                    var product = show_product[i];
                    var tag = '<li class="list-group-item">' + product.name + '</li>'
                    tags = tags + tag
                }
                document.querySelector('#result').innerHTML = tags;
            })
        })
    }

    $('#search').on('keyup', function () {
        var searchInput = $(this).val();
        if (searchInput.length <= 1) { //검색에 1개 이하일때 아무것도 안보여줌
            document.querySelector('#result').innerHTML = []
        }
        else{fetchJsonFilter(searchInput)}
    });

</script>

{% endblock %}